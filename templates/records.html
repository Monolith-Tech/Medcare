<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Record Details</title>
    <link
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      .chat-container {
        display: flex;
        flex-direction: column;
      }
      .chat-message {
        margin: 5px;
        padding: 10px;
        border-radius: 5px;
      }
      .doctor-message {
        align-self: flex-end;
        background-color: #dcf8c6;
      }
      .patient-message {
        align-self: flex-start;
        background-color: #f0f0f0;
      }
      .pre-wrap {
        white-space: pre-wrap; /* Allows text to wrap */
        word-wrap: break-word; /* Ensures words break to prevent overflow */
        background-color: #f8f9fa; /* Matches Bootstrap's default background */
        border-radius: 5px; /* Rounded corners for aesthetic appeal */
        border: 1px solid #ddd; /* Light border for definition */
        padding: 10px; /* Internal padding for better readability */
      }
    </style>
  </head>
  <body>
    <section class="container-fluid bg-light py-3">
      <div class="row justify-content-between">
        <div class="col-auto">
          <button class="btn btn-primary" onclick="window.location.href='/'">
            Home
          </button>
        </div>
        <div class="col-auto text-center">
          <h2>Medical Record Details</h2>
        </div>
        <div class="col-auto">
          <button
            class="btn btn-info"
            onclick="window.location.href='/diagnosis'"
          >
            Move to Differential Diagnosis
          </button>
        </div>
      </div>
    </section>



    <section class="container my-5">
      <h3>Document</h3>
      <div class="p-3 bg-light border rounded">
        <!-- Change pre to div and add an ID -->
        <div id="markdown-content" class="pre-wrap">{{ soap }}</div>
      </div>
    </section>
    

    <section class="container my-5">
      <h3>Conversation History</h3>
      <div class="chat-container">
        {% for entry in transcript %}
        <div
          class="chat-message {{ 'doctor-message' if entry.role == 'doctor' else 'patient-message' }}"
        >
          <strong>{{ entry.role.capitalize() }}:</strong> {{ entry.message }}
        </div>
        {% endfor %}
      </div>
    </section>

    <script>
      document.addEventListener('DOMContentLoaded', (event) => {
        // Get the Markdown content from the div
        const markdownContent = document.getElementById('markdown-content').innerText;
        // Convert the Markdown to HTML
        const htmlContent = marked.parse(markdownContent);
        // Replace the div's content with the converted HTML
        document.getElementById('markdown-content').innerHTML = htmlContent;
      });
    </script>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.2/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  </body>
</html>
